<h1>Welcome back, <%= current_user.username %></h1>
hr>


<ul>
  <li> <%= link_to 'Portfolio Summary', '#', class: 'active' %> </li>
  <% @accounts.each do |account| %>
    <li>
      <%= link_to account.account_name, account_path(account) %>
    </li>
  <% end %>
</ul>
<ul>
  <li><%= link_to '+ Add Portfolio', new_account_path(@account) %></li>
</ul>
<hr>
<hr>
<!-- TODO: Remove In-Line styling -->
<h1>Portfolio Summary Table <small style="font-size: .75rem">(all accts, positions)</small></h1>
<hr>
<table class='table'>
  <thead>
    <tr>
      <th>Ticker</th>
      <th>Shares</th>
      <th>Price</th>
      <th>Change</th>
      <th>Average Cost</th>
      <th>Profit/ Loss</th>
      <th>Dividend Yield</th>
      <th>Yield on Cost</th>
      <th>Annual Dividend Payment</th>
      <th>Annual Income</th>
      <th>Drip Adjusted Income</th>
    </tr>
  </thead>
  <tbody>
    <% @current_user_accounts.companies.uniq.each do |company| %>
      <tr>
        <%# NOTE Ticker %>
        <td><%= link_to company.symbol, '#' %> <br> <small><%= company.name %></small></td>
        <%# NOTE Shares %>
        <td><%= company.account_holdings.sum(:shares) %></td>
        <%# NOTE Price %>
        <td><%= number_to_currency(company.price_history_dailies.last.close) %></td>
        <%# NOTE Change %>
        <td></td>
        <%# NOTE Average Cost %>
        <td><%= number_to_currency(company.account_holdings.sum(:total_cost) / company.account_holdings.sum(:shares)) %></td>
        <%# NOTE Profit/Loss %>
        <td><%= number_to_currency(company.price_history_dailies.last.close - (company.account_holdings.sum(:total_cost) / company.account_holdings.sum(:shares))) %></td>
        <%# NOTE Dividend Yield %>
        <td><%= number_to_percentage(company.dividend_yield, precision: 2) %></td>
        <%# NOTE Yield on Cost %>
        <td><%= number_to_percentage(company.company_infos.last.dividend_per_share / (company.account_holdings.sum(:total_cost) / company.account_holdings.sum(:shares)) * 100, precision: 2) %></td>
        <%# NOTE Annual Dividend Payout %>
        <td><%= number_to_currency(company.company_infos.last.dividend_per_share) %></td>
        <%# NOTE Annual Dividend Income %>
        <td><%= number_to_currency(company.company_infos.last.dividend_per_share * company.account_holdings.sum(:shares)) %></td>
        <%# NOTE Annual Adjusted Drip Income %>
        <td></td>
      </tr>
    <% end %>
  </tbody>
</table>
<hr>



<br>
<hr>
<hr>
<h1>Sector Pie chart</h1>
<hr>
