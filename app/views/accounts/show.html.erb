<p style="color: green"><%= notice %></p>

<table class='table'>
  <thead>
    <tr>
      <th scope='col'>TICKER</th>
      <th scope='col'>SHARES</th>
      <th scope='col'>PRICE</th>
      <th scope='col'>CHANGE</th>
      <th scope='col'>AVERAGE COST</th>
      <th scope='col'>PROFIT/LOSS</th>
      <th scope='col'>DIVIDEND YIELD</th>
      <th scope='col'>YIELD ON COST</th>
      <th scope='col'>DIVIDEND PER SHARE</th>
      <th scope='col'>ANNUAL INCOME</th>
      <th scope='col'>misc</th>
    </tr>
  </thead>
  <tbody class="table-striped">
    <% @current_user_accounts.companies.uniq.each do |company| %>
      <tr>
        <!-- <p> ticker </p> -->
        <td><%= link_to company.symbol, '#' %> <br> <small><%= company.name %></small></td>
        <!-- <p> shares </p> -->
        <td><%= company.account_holdings.where(account_id: @current_user_accounts).sum(:shares) %></td>
        <!-- <p> price </p> -->
        <td><%= number_to_currency(company.price_history_dailies.last.close) %></td>
        <!-- <p> change </p> -->
        <td></td>
        <!-- <p> average cost </p> -->
        <td><%= number_to_currency(company.account_holdings.sum(:total_cost) / company.account_holdings.sum(:shares)) %></td>
        <!-- <p> profit/loss </p> -->
        <td><%= number_to_currency(company.price_history_dailies.last.close - (company.account_holdings.sum(:total_cost) / company.account_holdings.sum(:shares))) %></td>
        <!-- <p> dividend yield </p> -->
        <td><%= number_to_percentage(company.dividend_yield, precision: 2) %></td>
        <!-- <p> yield on cost </p> -->
        <td><%= number_to_percentage(company.company_infos.last.dividend_per_share / (company.account_holdings.sum(:total_cost) / company.account_holdings.sum(:shares)) * 100, precision: 2) %></td>
        <!-- <p> dividend per share </p> -->
        <td><%= number_to_currency(company.company_infos.last.dividend_per_share) %></td>
        <!-- <p> Dividend Annual Income </p> -->
        <td><%= number_to_currency(company.company_infos.last.dividend_per_share * company.account_holdings.where(account_id: @current_user_accounts).sum(:shares)) %></td>
        <!-- <p> Dividend Payout </p> -->
        <td></td>
      </tr>
    <% end %>
  </tbody>
</table>

<p>Total amount of shares owned: <%# @account.account_holdings.sum(:shares) %></p>
<p>Total amount of money invested: <%# @account.account_holdings.sum(:total_cost) %></p>
<p>Total amount of annual income: <%# @sum.sum %></p>
<br>
<%# company.dividend_histories.last.frequency %>
<%# Company.find(55).company_infos.last.dividend_per_share %>
<%# Company.find(55).company_infos.last.dividend_yield %>
<br>

<%# total_shares_owned = Company.find(55).account_holdings.sum(:shares) %>
<%# annual_dividend_payout = (Company.find(55).company_infos.last.dividend_per_share * Company.find(55).account_holdings.sum(:shares)) %>

    <div>
      <%= link_to "Edit this account", edit_account_path(@account) %> |
      <%= link_to "Back to dashboard", root_path %>

      <%= button_to "Destroy this account", @account, method: :delete %>
    </div>
